<Project Sdk="Microsoft.NET.Sdk">
    <PropertyGroup>
        <TargetFrameworks>net6.0</TargetFrameworks>
        <IsPackable>false</IsPackable>
        <IsPublishable>false</IsPublishable>
    </PropertyGroup>
    <ItemGroup>
        <PackageReference Include="Microsoft.NET.Test.Sdk" Version="17.7.2" />
        <PackageReference Include="coverlet.collector" Version="6.0.0" />
        <PackageReference Include="xunit.runner.visualstudio" Version="2.5.0" />
        <PackageReference Include="xunit" Version="2.5.0" />
        <PackageReference Include="Azure.Identity" Version="1.10.1" />
        <PackageReference Include="Azure.Data.Tables" Version="12.8.0" />
        <PackageReference Include="Azure.Storage.Blobs" Version="12.17.0" />
        <PackageReference Include="Azure.Storage.Queues" Version="12.15.0" />
    </ItemGroup>
    <ItemGroup>
        <ProjectReference Include="$(SolutionDir)src/Testcontainers.Azurite/Testcontainers.Azurite.csproj" />
        <ProjectReference Include="$(SolutionDir)tests/Testcontainers.Commons/Testcontainers.Commons.csproj" />
    </ItemGroup>

    <Target Name="GenerateTestCertificatePreBuild" BeforeTargets="PreBuildEvent">
        <Exec ContinueOnError="true" Command="mkcert" StandardOutputImportance="low" StandardErrorImportance="low">
            <Output TaskParameter="ExitCode" PropertyName="InstalledMkCert" />
        </Exec>

        <PropertyGroup>
            <IsInstalledMkCert>false</IsInstalledMkCert>
            <IsInstalledMkCert Condition=" '$(InstalledMkCert)' == '0' ">true</IsInstalledMkCert>
        </PropertyGroup>

        <Error Condition=" '$(IsInstalledMkCert)' != 'true' " Text="mkcert not available. Please install mkcert and run `mkcert -install`." />

        <MakeDir Directories="$(ProjectDir)cert" />
        <Exec
            Condition=" '$(IsInstalledMkCert)' == 'true' and !Exists('$(ProjectDir)cert\127.0.0.1.pem') "
            Command="mkcert 127.0.0.1"
            WorkingDirectory="$(ProjectDir)cert"
            StandardOutputImportance="low"
            StandardErrorImportance="low" />
    </Target>
</Project>